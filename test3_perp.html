<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
  <title>Country Pictures</title>
<style>
.autocomplete {
  position: relative;
  display: inline-block;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  top: 100%;
  left: 0;
  right: 0;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff; 
  border-bottom: 1px solid #d4d4d4; 
}

.autocomplete-items div:hover {
  background-color: #e9e9e9; 
}

.autocomplete-active {
  background-color: DodgerBlue !important; 
  color: #ffffff; 
}
</style>
</head>
<body>
<div class="autocomplete">
  <input type="text" id="countryInput" placeholder="Type a country name">
  <div id="autocomplete-list" class="autocomplete-items"></div>
</div>
<script>
let countryData = {};
let flatCountryData = [];

// Fetch the JSON data
fetch('https://robbieandrew.github.io/data/countryData.json')
  .then(response => response.json())
  .then(data => {
    countryData = data;
    flatCountryData = Object.entries(countryData).flatMap(
      ([code, data]) => data.variants.map(variant => ({variant, code}))
    );
    // Initialize autocomplete after data is loaded
    autocomplete(document.getElementById("countryInput"));
  })
  .catch(error => console.error('Error loading country data:', error));

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function autocomplete(inp) {
  const MAX_RESULTS = 10;
  
  const showResults = debounce((inputValue) => {
    const matchingCountries = flatCountryData.filter(item => 
      item.variant.toLowerCase().startsWith(inputValue.toLowerCase())
    ).slice(0, MAX_RESULTS);

    const listContainer = document.getElementById("autocomplete-list");
    listContainer.innerHTML = '';

    if (matchingCountries.length > 0) {
      const fragment = document.createDocumentFragment();
      matchingCountries.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${item.variant.substr(0, inputValue.length)}</strong>${item.variant.substr(inputValue.length)}`;
        div.addEventListener("click", function() {
          inp.value = item.code;
          listContainer.innerHTML = '';
        });
        fragment.appendChild(div);
      });
      listContainer.appendChild(fragment);
    }
  }, 300);

  inp.addEventListener("input", function() {
    showResults(this.value);
  });

  document.addEventListener("click", function(e) {
    if (e.target !== inp) {
      document.getElementById("autocomplete-list").innerHTML = '';
    }
  });
}

// Initialize
autocomplete(document.getElementById("countryInput"));

</script>
</body>
</html>
